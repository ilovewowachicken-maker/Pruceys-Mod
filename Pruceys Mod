local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local mouse = player:GetMouse()

-- Global Sound Object
local clientSound = player:FindFirstChild("PruceyModSound") or Instance.new("Sound", player)
clientSound.Name = "PruceyModSound"

-- UI Setup
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "PruceysModUI"
screenGui.ResetOnSpawn = false

-- Open Button
local openBtn = Instance.new("TextButton", screenGui)
openBtn.Size = UDim2.new(0, 60, 0, 60)
openBtn.Position = UDim2.new(0, 20, 0.5, -30)
openBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
openBtn.Text = "DEV"
openBtn.TextColor3 = Color3.fromRGB(255, 0, 0)
openBtn.Font = Enum.Font.SourceSansBold
openBtn.TextSize = 25
openBtn.Visible = false
Instance.new("UICorner", openBtn).CornerRadius = UDim.new(1, 0)

-- Main Frame
local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 500, 0, 450)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -225)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.Active = true
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 12)
local panelStroke = Instance.new("UIStroke", mainFrame)
panelStroke.Color = Color3.fromRGB(0, 150, 255)
panelStroke.Thickness = 3

-- TOP BAR
local topBar = Instance.new("Frame", mainFrame)
topBar.Size = UDim2.new(1, 0, 0, 40)
topBar.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Instance.new("UICorner", topBar).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", topBar)
title.Text = "Pruceys Mod"
title.Size = UDim2.new(1, -50, 1, 0)
title.Position = UDim2.new(0, 15, 0, 0)
title.TextColor3 = Color3.fromRGB(255, 0, 0)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 22
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Left

local closeBtn = Instance.new("TextButton", topBar)
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.Font = Enum.Font.SourceSansBold
Instance.new("UICorner", closeBtn)

-- Navigation Sidebar
local sidebar = Instance.new("Frame", mainFrame)
sidebar.Size = UDim2.new(0, 110, 1, -60)
sidebar.Position = UDim2.new(0, 10, 0, 50)
sidebar.BackgroundTransparency = 1
Instance.new("UIListLayout", sidebar).Padding = UDim.new(0, 8)

local container = Instance.new("Frame", mainFrame)
container.Size = UDim2.new(1, -140, 1, -60)
container.Position = UDim2.new(0, 130, 0, 50)
container.BackgroundTransparency = 1

-- VIEW NAVIGATOR
local viewNav = Instance.new("Frame", screenGui)
viewNav.Size = UDim2.new(0, 320, 0, 50)
viewNav.Position = UDim2.new(0.5, -160, 0.85, 0)
viewNav.BackgroundTransparency = 1
viewNav.Visible = false

local function styleNavBtn(btn, text, size, pos)
    btn.Size = size
    btn.Position = pos
    btn.BackgroundColor3 = Color3.new(0,0,0)
    btn.Text = text
    btn.TextColor3 = Color3.new(1,0,0)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 14
    Instance.new("UICorner", btn)
    local s = Instance.new("UIStroke", btn)
    s.Color = Color3.fromRGB(0, 150, 255)
    s.Thickness = 2
end

local prevBtn = Instance.new("TextButton", viewNav); styleNavBtn(prevBtn, "<", UDim2.new(0, 45, 1, 0), UDim2.new(0, 0, 0, 0))
local stopBtn = Instance.new("TextButton", viewNav); styleNavBtn(stopBtn, "STOP VIEWING", UDim2.new(0, 220, 1, 0), UDim2.new(0, 50, 0, 0))
local nextBtn = Instance.new("TextButton", viewNav); styleNavBtn(nextBtn, ">", UDim2.new(0, 45, 1, 0), UDim2.new(0, 275, 0, 0))

-- Variables
local pages = {}
local flying, noclip, espEnabled, infJump = false, false, false, false
local flySpeed, walkSpeed, jumpPower = 50, 16, 50
local viewIndex = 1

-- Helpers
local function createStyledBtn(text, parent, callback)
    local b = Instance.new("TextButton", parent)
    b.Size = UDim2.new(1, -10, 0, 40)
    b.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    b.Text = text
    b.TextColor3 = Color3.fromRGB(255, 0, 0)
    b.Font = Enum.Font.SourceSansBold
    b.TextSize = 14
    Instance.new("UICorner", b)
    b.MouseButton1Click:Connect(function() callback(b) end)
    return b
end

local function createStyledInput(placeholder, parent, callback)
    local tb = Instance.new("TextBox", parent)
    tb.Size = UDim2.new(1, -10, 0, 40)
    tb.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    tb.PlaceholderText = placeholder
    tb.Text = ""
    tb.TextColor3 = Color3.fromRGB(255, 0, 0)
    tb.Font = Enum.Font.SourceSansBold
    tb.TextSize = 14
    Instance.new("UICorner", tb)
    tb.FocusLost:Connect(function(enter) if enter then callback(tb.Text) end end)
    return tb
end

local function createPage(name)
    local scroll = Instance.new("ScrollingFrame", container)
    scroll.Name = name
    scroll.Size = UDim2.new(1, 0, 1, 0)
    scroll.Visible = false
    scroll.BackgroundTransparency = 1
    scroll.ScrollBarThickness = 4
    scroll.ScrollBarImageColor3 = Color3.fromRGB(0, 150, 255)
    local list = Instance.new("UIListLayout", scroll)
    list.Padding = UDim.new(0, 10)
    list:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scroll.CanvasSize = UDim2.new(0, 0, 0, list.AbsoluteContentSize.Y + 20)
    end)
    pages[name] = scroll
    createStyledBtn(name:upper(), sidebar, function()
        for _, p in pairs(pages) do p.Visible = false end
        scroll.Visible = true
    end)
    return scroll
end

local selfPage = createPage("Self")
local playerPage = createPage("Players")
local worldPage = createPage("World")
local serverPage = createPage("Server")
local musicPage = createPage("Music")

-- SELF TAB CONTENT
createStyledInput("WalkSpeed...", selfPage, function(v) walkSpeed = tonumber(v) or 16 end)
createStyledInput("JumpPower...", selfPage, function(v) jumpPower = tonumber(v) or 50 end)
createStyledInput("Fly Speed...", selfPage, function(v) flySpeed = tonumber(v) or 50 end)
createStyledBtn("Fly: OFF", selfPage, function(b)
    flying = not flying
    b.Text = flying and "Fly: ON" or "Fly: OFF"
    local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if root and flying then
        local bv = Instance.new("BodyVelocity", root); bv.Name = "FlyV"; bv.MaxForce = Vector3.new(1,1,1)*math.huge; bv.Velocity = Vector3.new(0,0,0)
        local bg = Instance.new("BodyGyro", root); bg.Name = "FlyG"; bg.MaxTorque = Vector3.new(1,1,1)*math.huge; bg.CFrame = root.CFrame
    elseif root then
        if root:FindFirstChild("FlyV") then root.FlyV:Destroy() end
        if root:FindFirstChild("FlyG") then root.FlyG:Destroy() end
    end
end)
createStyledBtn("Noclip: OFF", selfPage, function(b) 
    noclip = not noclip
    b.Text = noclip and "Noclip: ON" or "Noclip: OFF"
end)
createStyledBtn("Inf Jump: OFF", selfPage, function(b)
    infJump = not infJump
    b.Text = infJump and "Inf Jump: ON" or "Inf Jump: OFF"
end)

-- PLAYER LIST
local function refreshPlayers()
    playerPage:ClearAllChildren()
    Instance.new("UIListLayout", playerPage).Padding = UDim.new(0, 10)
    createStyledBtn("REFRESH LIST", playerPage, refreshPlayers).BackgroundColor3 = Color3.fromRGB(40,0,0)
    local allP = Players:GetPlayers()
    for i, p in pairs(allP) do
        if p ~= player then
            local row = Instance.new("Frame", playerPage)
            row.Size = UDim2.new(1, -10, 0, 40); row.BackgroundTransparency = 1
            createStyledBtn("TP", row, function() player.Character:MoveTo(p.Character.PrimaryPart.Position) end).Size = UDim2.new(0.3, 0, 1, 0)
            local vw = createStyledBtn("VIEW: "..p.DisplayName, row, function()
                camera.CameraSubject = p.Character:FindFirstChild("Humanoid")
                viewIndex = i; stopBtn.Text = "STOP: "..p.DisplayName:upper(); viewNav.Visible = true
            end)
            vw.Size = UDim2.new(0.65, 0, 1, 0); vw.Position = UDim2.new(0.35, 0, 0, 0)
        end
    end
end
refreshPlayers()

-- SERVER
createStyledBtn("SERVER HOP", serverPage, function()
    local x = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
    for _, v in pairs(x.data) do if v.playing < v.maxPlayers and v.id ~= game.JobId then TeleportService:TeleportToPlaceInstance(game.PlaceId, v.id, player) break end end
end)
createStyledBtn("KICK SELF", serverPage, function() player:Kick("You kicked yourself! ðŸ˜‰") end)

-- MUSIC
local playingText = Instance.new("TextLabel", musicPage)
playingText.Size = UDim2.new(1, -10, 0, 20)
playingText.BackgroundTransparency = 1
playingText.TextColor3 = Color3.new(0, 0.6, 1)
playingText.Text = "Nothing Playing"
playingText.Font = Enum.Font.SourceSansItalic
playingText.TextSize = 14

createStyledInput("Enter Sound ID...", musicPage, function(v)
    local id = v:match("%d+")
    if id then 
        clientSound:Stop()
        clientSound.SoundId = "rbxassetid://"..id
        clientSound:Play() 
        playingText.Text = "Playing ID: "..id
    end
end)

createStyledBtn("STOP MUSIC", musicPage, function() 
    clientSound:Stop() 
    playingText.Text = "Music Stopped"
end)

-- WORLD (ESP)
createStyledBtn("ESP: OFF", worldPage, function(b) espEnabled = not espEnabled; b.Text = espEnabled and "ESP: ON" or "ESP: OFF" end)

-- NAV LOGIC
stopBtn.MouseButton1Click:Connect(function() camera.CameraSubject = player.Character:FindFirstChild("Humanoid"); viewNav.Visible = false end)

-- ESP LOGIC
local function createESP(p)
    if screenGui:FindFirstChild("ESP_"..p.Name) then return end
    local folder = Instance.new("Folder", screenGui); folder.Name = "ESP_"..p.Name
    local bg = Instance.new("BillboardGui", folder)
    bg.AlwaysOnTop = true; bg.Size = UDim2.new(4, 0, 5, 0); bg.Name = "UI"; bg.ZIndexBehavior = Enum.ZIndexBehavior.Global
    local box = Instance.new("Frame", bg); box.Size = UDim2.new(1, 0, 1, 0); box.BackgroundTransparency = 0.7; box.BackgroundColor3 = Color3.new(1, 0, 0)
    Instance.new("UIStroke", box).Color = Color3.new(1,0,0)
    local txt = Instance.new("TextLabel", bg)
    txt.Text = p.DisplayName; txt.Size = UDim2.new(2, 0, 0.5, 0); txt.Position = UDim2.new(-0.5, 0, -0.7, 0)
    txt.TextColor3 = Color3.new(1,1,1); txt.BackgroundTransparency = 1; txt.Font = Enum.Font.SourceSansBold; txt.TextSize = 16; txt.ZIndex = 10
end

-- MAIN LOOPS
RunService.Stepped:Connect(function()
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.WalkSpeed = walkSpeed
        player.Character.Humanoid.JumpPower = jumpPower
    end
    if noclip and player.Character then
        for _, part in pairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
    for _, p in pairs(Players:GetPlayers()) do
        local folder = screenGui:FindFirstChild("ESP_"..p.Name)
        if espEnabled and p ~= player and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            if not folder then createESP(p) else folder.UI.Adornee = p.Character.HumanoidRootPart end
        elseif folder then folder:Destroy() end
    end
end)

RunService.RenderStepped:Connect(function()
    local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if flying and root and root:FindFirstChild("FlyV") then
        local dir = Vector3.new(0,0,0)
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir = dir + camera.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir = dir - camera.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir = dir - camera.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir = dir + camera.CFrame.RightVector end
        root.FlyV.Velocity = dir * flySpeed
        root.FlyG.CFrame = camera.CFrame
    end
end)

-- Infinite Jump Logic
UserInputService.JumpRequest:Connect(function()
    if infJump and player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
        player.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
    end
end)

-- Dragging
local dragging, dragStart, startPos
topBar.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true dragStart = input.Position startPos = mainFrame.Position end end)
UserInputService.InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then local delta = input.Position - dragStart mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)
UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

closeBtn.MouseButton1Click:Connect(function() mainFrame.Visible = false; openBtn.Visible = true end)
openBtn.MouseButton1Click:Connect(function() mainFrame.Visible = true; openBtn.Visible = false end)
pages["Self"].Visible = true
